<html>
    <body>
        <h3><a href="./map.html">map</a></h1>
            <table border=1 id="dataTable" cellpadding=10 style="table-layout:fixed;word-wrap:break-word;word-break:break-all;">
                <tr>
			<th>TIME</th><th>LAT</th><th>LON</th><th>altitude</th><th>NMEA String</th>
                </tr>
            </table>
            <script>
//var ws = new WebSocket('ws://206.189.172.146:8080/');
var ws = new WebSocket('ws://localhost:8080/');

ws.onmessage = function(event) {
    var nmeaString = event.data;

    var gpgga = nmeaString.split(',');

    var hhmmss = gpgga[1];

    // change from UTC to PST
    var hh = parseInt(hhmmss.substring(0,2));
    if(hh > 7) {
        hh = hh - 7;
    }
    else {
        hh = hh + 17;
    }
    var mm = hhmmss.substring(2,4);
    var ss = hhmmss.substring(4,6);
    var time = hh + ":" + mm + ":" + ss;
    var lat = parseFloat(gpgga[2]);
    var lon = parseFloat(gpgga[4]);
    var alt = parseFloat(gpgga[9]);
    var altFeet = alt * 3.28084;

    var lat_deg = Math.trunc(lat / 100);
    var lat_min = lat % 100;
    var lon_deg = Math.trunc(lon / 100);
    var lon_min = lon % 100;

    var latitude = lat_deg + (lat_min/60);
    var longitude = lon_deg + (lon_min/60);

    latDir = gpgga[3];
    lonDir = gpgga[5];

    if(latDir == 'S') {
        latitude *= -1;
    }
    if(lonDir == 'W') {
        longitude *= -1;
    }

    var coords = [latitude,longitude];

    var table = document.getElementById("dataTable");

    var newRow = table.insertRow(1);

    var timestamp = newRow.insertCell(0);
    var latCell = newRow.insertCell(1);
    var lonCell = newRow.insertCell(2);
    var altCell = newRow.insertCell(3);
    var gpggaCell = newRow.insertCell(4);

    var nmeaArray = nmeaString.replace(',','<br>')
    timestamp.innerHTML = time;
    latCell.innerHTML = parseFloat(latitude).toFixed(3);
    lonCell.innerHTML = parseFloat(longitude).toFixed(3);
    gpggaCell.innerHTML = gpgga.slice(1,gpgga.length-1);
	altCell.innerHTML = alt + " M <br>(" + parseFloat(altFeet.toFixed(0)) + " ft)";
}
            </script>
    </body>
</html>


